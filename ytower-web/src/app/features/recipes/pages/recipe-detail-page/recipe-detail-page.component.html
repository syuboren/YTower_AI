<div class="recipe-detail-page">
  @if (recipe(); as recipe) {
    <!-- AI Hero Banner -->
    <section class="ai-banner">
      <div class="container">
        <div class="ai-banner__content">
          <h2 class="ai-banner__title">AI 食譜生成助手</h2>
          <p class="ai-banner__subtitle">從靈感到餐桌，只要一個步驟</p>
          <a routerLink="/ai-assistant" class="ai-banner__btn">✨ 生成食譜</a>
        </div>
      </div>
    </section>

    <div class="container">
      <app-breadcrumb [items]="breadcrumbItems()" />

      <!-- Recipe Header -->
      <header class="recipe-header">
        <h1 class="recipe-header__title">{{ recipe.title }}</h1>
        
        <div class="recipe-header__actions">
          <button class="action-btn" (click)="printRecipe()">
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="6 9 6 2 18 2 18 9"></polyline>
              <path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"></path>
              <rect x="6" y="14" width="12" height="8"></rect>
            </svg>
            列印食譜
          </button>
          <button class="action-btn" (click)="copyLink()">
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path>
              <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path>
            </svg>
            複製連結
          </button>
          <button class="action-btn action-btn--primary">
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M19 21l-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z"></path>
            </svg>
            收藏食譜
          </button>
          <button class="action-btn" (click)="shareToFacebook()">
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
              <path d="M9 8h-3v4h3v12h5v-12h3.642l.358-4h-4v-1.667c0-.955.192-1.333 1.115-1.333h2.885v-5h-3.808c-3.596 0-5.192 1.583-5.192 4.615v3.385z"/>
            </svg>
          </button>
        </div>

        <div class="recipe-header__meta">
          <span class="meta-item">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="12" cy="12" r="10"></circle>
              <polyline points="12 6 12 12 16 14"></polyline>
            </svg>
            烹飪時間：{{ recipe.cookingTime }} 分鐘
          </span>
          <span class="meta-item">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
              <circle cx="9" cy="7" r="4"></circle>
              <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
              <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
            </svg>
            標準食用人數：{{ recipe.servings }} 人份
          </span>
          <span class="meta-item">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
              <line x1="16" y1="2" x2="16" y2="6"></line>
              <line x1="8" y1="2" x2="8" y2="6"></line>
              <line x1="3" y1="10" x2="21" y2="10"></line>
            </svg>
            上傳日期：{{ recipe.uploadDate }}
          </span>
          <span class="meta-item meta-item--collect">
            已有 1,234 人收藏這道食譜！你也來試試吧！
          </span>
        </div>
      </header>

      <!-- Recipe Description -->
      <section class="recipe-intro">
        <div class="recipe-intro__image">
          <img [src]="recipe.imageUrl" [alt]="recipe.title">
        </div>
        <p class="recipe-intro__description">{{ recipe.description }}</p>
      </section>

      <!-- Ingredients & Video -->
      <div class="recipe-content">
        <div class="recipe-content__main">
          <!-- Ingredients -->
          <section class="ingredients-section">
            <div class="section-header">
              <h2 class="section-title">材料</h2>
              <div class="servings-control">
                <button class="servings-btn" (click)="decreaseServings()">−</button>
                <span class="servings-value">{{ servings() }} 人份</span>
                <button class="servings-btn" (click)="increaseServings()">+</button>
              </div>
            </div>

            <div class="ingredients-table">
              <div class="ingredients-column">
                <h3 class="ingredients-column__title">食材</h3>
                @for (ing of recipe.ingredients; track ing.name) {
                  <div class="ingredient-row">
                    <span class="ingredient-name">{{ ing.name }}</span>
                    <span class="ingredient-amount">{{ ing.amount }} {{ ing.unit }}</span>
                  </div>
                }
              </div>
              <div class="ingredients-column">
                <h3 class="ingredients-column__title">調味料</h3>
                @for (group of recipe.seasonings; track group.group) {
                  <div class="seasoning-group">
                    <span class="seasoning-label">調味料 {{ group.group }}</span>
                    @for (item of group.items; track item.name) {
                      <div class="ingredient-row">
                        <span class="ingredient-name">{{ item.name }}</span>
                        <span class="ingredient-amount">{{ item.amount }}</span>
                      </div>
                    }
                  </div>
                }
              </div>
            </div>
          </section>

          <!-- Kitchenware -->
          @if (recipe.kitchenware && recipe.kitchenware.length > 0) {
            <section class="kitchenware-section">
              <h2 class="section-title">使用器具</h2>
              <div class="kitchenware-list">
                @for (item of recipe.kitchenware; track item.id) {
                  <div class="kitchenware-item">
                    <span class="kitchenware-name">Woody 木質調磨石陶瓷瓶底深鍋 26cm</span>
                    <a [href]="item.purchaseUrl" target="_blank" class="kitchenware-link">立即選購</a>
                  </div>
                }
              </div>
            </section>
          }

          <!-- Steps -->
          <section class="steps-section">
            <h2 class="section-title">製作步驟</h2>
            <ol class="steps-list">
              @for (step of recipe.steps; track step.stepNumber) {
                <li class="step-item" [class.step-item--completed]="isStepCompleted(step.stepNumber)">
                  <label class="step-checkbox">
                    <input 
                      type="checkbox" 
                      [checked]="isStepCompleted(step.stepNumber)"
                      (change)="toggleStep(step.stepNumber)"
                    >
                    <span class="step-checkmark"></span>
                  </label>
                  <div class="step-content">
                    <span class="step-number">步驟 {{ step.stepNumber }}</span>
                    <p class="step-description">{{ step.description }}</p>
                  </div>
                </li>
              }
            </ol>
          </section>

          <!-- Tags -->
          <section class="tags-section">
            <h3 class="tags-title">此食譜標籤</h3>
            <div class="tags-list">
              @for (tag of recipe.tags; track tag) {
                <span class="tag">{{ tag }}</span>
              }
            </div>
          </section>
        </div>

        <!-- Video Section -->
        <aside class="recipe-content__video">
          <div class="video-wrapper">
            <img [src]="recipe.imageUrl" [alt]="recipe.title">
            <button class="video-play-btn">
              <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="currentColor">
                <polygon points="5 3 19 12 5 21 5 3"></polygon>
              </svg>
            </button>
          </div>
        </aside>
      </div>

      <!-- Rating Section -->
      <section class="rating-section">
        <div class="rating-card">
          <div class="rating-card__existing">
            <h3>食譜評價</h3>
            <div class="rating-display">
              <span class="rating-score">{{ recipe.rating }}</span>
              <div class="rating-stars">
                @for (star of [1,2,3,4,5]; track star) {
                  <span class="star" [class.star--filled]="star <= recipe.rating">★</span>
                }
              </div>
              <span class="rating-count">({{ recipe.ratingCount }})</span>
            </div>
          </div>
          <div class="rating-card__user">
            <h3>你的評價</h3>
            <div class="rating-input">
              @for (star of [1,2,3,4,5]; track star) {
                <button 
                  class="star-btn" 
                  [class.star-btn--active]="star <= userRating()"
                  (click)="setRating(star)"
                >
                  ★
                </button>
              }
            </div>
          </div>
        </div>
      </section>

      <!-- Related Recipes -->
      <section class="related-section">
        <h2 class="section-title">其他相似食譜推薦</h2>
        <div class="related-grid">
          @for (related of relatedRecipes(); track related.id) {
            <app-recipe-card
              [id]="related.id"
              [title]="related.title"
              [imageUrl]="related.imageUrl"
              [cookingTime]="related.cookingTime"
              [rating]="related.rating"
            />
          }
        </div>
      </section>
    </div>

    <app-cta-section />
  } @else {
    <div class="container">
      <div class="not-found">
        <h1>找不到此食譜</h1>
        <p>抱歉，您要找的食譜不存在或已被移除。</p>
        <a routerLink="/recipes" class="btn">返回食譜列表</a>
      </div>
    </div>
  }
</div>

