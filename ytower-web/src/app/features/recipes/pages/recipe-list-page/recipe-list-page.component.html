<div class="recipe-list-page">
  <!-- Hero Section with Search -->
  <section class="search-hero">
    <div class="search-hero__bg"></div>
    <div class="container">
      <h1 class="search-hero__title">今天吃什麼？</h1>
      <p class="search-hero__subtitle">輸入食材、料理名稱或類別，找到你想要的美味食譜</p>
      
      <div class="search-box">
        <div class="search-box__input-wrapper">
          <svg class="search-box__icon" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="11" cy="11" r="8"></circle>
            <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
          </svg>
          <input 
            type="text" 
            class="search-box__input" 
            placeholder="搜尋食譜、食材、類別..."
            [(ngModel)]="searchQuery"
            (keydown.enter)="onSearch()"
          >
          @if (searchQuery()) {
            <button type="button" class="search-box__clear" (click)="clearSearch()">
              <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="18" y1="6" x2="6" y2="18"></line>
                <line x1="6" y1="6" x2="18" y2="18"></line>
              </svg>
            </button>
          }
        </div>
        <button type="button" class="search-box__btn" (click)="onSearch()">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="11" cy="11" r="8"></circle>
            <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
          </svg>
          搜尋食譜
        </button>
      </div>

      <!-- 熱門搜尋 -->
      <div class="popular-keywords">
        <span class="popular-keywords__label">熱門搜尋：</span>
        @for (keyword of popularKeywords; track keyword) {
          <button type="button" class="popular-keywords__tag" (click)="searchKeyword(keyword)">
            {{ keyword }}
          </button>
        }
      </div>
    </div>
  </section>

  <div class="container">
    <app-breadcrumb [items]="breadcrumbItems" />
  </div>

  <!-- 搜尋結果區塊 -->
  @if (hasSearched()) {
    <section class="search-results">
      <div class="container">
        <!-- 搜尋結果標題 -->
        <div class="results-header">
          <div class="results-header__info">
            <h2 class="results-header__title">
              @if (searchQuery()) {
                「{{ searchQuery() }}」的搜尋結果
              } @else {
                所有食譜
              }
            </h2>
            <span class="results-header__count">共 {{ totalResults() }} 筆結果</span>
          </div>

          <div class="results-header__actions">
            <!-- 篩選器 -->
            <div class="filter-group">
              <select 
                class="filter-select"
                [value]="selectedTime()"
                (change)="selectedTime.set($any($event.target).value); onFilterChange()"
              >
                @for (option of timeOptions; track option.value) {
                  <option [value]="option.value">{{ option.label }}</option>
                }
              </select>
              <select 
                class="filter-select"
                [value]="selectedStyle()"
                (change)="selectedStyle.set($any($event.target).value); onFilterChange()"
              >
                @for (option of styleOptions; track option.value) {
                  <option [value]="option.value">{{ option.label }}</option>
                }
              </select>
            </div>

            <!-- 檢視模式切換 -->
            <div class="view-toggle">
              <button 
                type="button" 
                class="view-toggle__btn" 
                [class.view-toggle__btn--active]="viewMode() === 'bento'"
                (click)="setViewMode('bento')"
                title="拼貼牆檢視"
              >
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <rect x="3" y="3" width="7" height="7"></rect>
                  <rect x="14" y="3" width="7" height="4"></rect>
                  <rect x="14" y="10" width="7" height="7"></rect>
                  <rect x="3" y="14" width="7" height="7"></rect>
                </svg>
              </button>
              <button 
                type="button" 
                class="view-toggle__btn" 
                [class.view-toggle__btn--active]="viewMode() === 'list'"
                (click)="setViewMode('list')"
                title="列表檢視"
              >
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <line x1="8" y1="6" x2="21" y2="6"></line>
                  <line x1="8" y1="12" x2="21" y2="12"></line>
                  <line x1="8" y1="18" x2="21" y2="18"></line>
                  <line x1="3" y1="6" x2="3.01" y2="6"></line>
                  <line x1="3" y1="12" x2="3.01" y2="12"></line>
                  <line x1="3" y1="18" x2="3.01" y2="18"></line>
                </svg>
              </button>
            </div>
          </div>
        </div>

        @if (isSearching()) {
          <!-- 載入中 -->
          <div class="loading-state">
            <div class="loading-spinner"></div>
            <p>搜尋中...</p>
          </div>
        } @else if (totalResults() === 0) {
          <!-- 無結果 -->
          <div class="empty-state">
            <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
              <circle cx="11" cy="11" r="8"></circle>
              <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
              <line x1="8" y1="8" x2="14" y2="14"></line>
              <line x1="14" y1="8" x2="8" y2="14"></line>
            </svg>
            <h3>找不到相關食譜</h3>
            <p>試試其他關鍵字，或瀏覽我們的推薦食譜</p>
            <button type="button" class="empty-state__btn" (click)="clearSearch()">查看所有食譜</button>
          </div>
        } @else {
          <!-- Bento 拼貼牆模式 -->
          @if (viewMode() === 'bento') {
            <div class="bento-grid">
              @for (recipe of displayedRecipes(); track recipe.id; let i = $index) {
                <a 
                  [routerLink]="['/recipes', recipe.id]" 
                  class="bento-card scroll-animate fade-up"
                  [class.bento-card--large]="getBentoSize(i) === 'large'"
                  [class.bento-card--wide]="getBentoSize(i) === 'wide'"
                  [class.bento-card--tall]="getBentoSize(i) === 'tall'"
                  [style.--delay]="(i % 6) * 0.1 + 's'"
                >
                  <img [src]="recipe.imageUrl" [alt]="recipe.title" class="bento-card__image" loading="lazy">
                  <div class="bento-card__overlay"></div>
                  <div class="bento-card__content">
                    <div class="bento-card__tags">
                      @for (tag of recipe.tags.slice(0, 2); track tag) {
                        <span class="bento-card__tag">{{ tag }}</span>
                      }
                    </div>
                    <h3 class="bento-card__title">{{ recipe.title }}</h3>
                    <div class="bento-card__meta">
                      <span class="bento-card__time">
                        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                          <circle cx="12" cy="12" r="10"></circle>
                          <polyline points="12 6 12 12 16 14"></polyline>
                        </svg>
                        {{ recipe.cookingTime }} 分鐘
                      </span>
                      <span class="bento-card__rating">★ {{ recipe.rating }}</span>
                    </div>
                  </div>
                </a>
              }
            </div>
          }

          <!-- 列表模式 -->
          @if (viewMode() === 'list') {
            <div class="list-view">
              @for (recipe of displayedRecipes(); track recipe.id; let i = $index) {
                <a 
                  [routerLink]="['/recipes', recipe.id]" 
                  class="list-card scroll-animate fade-up"
                  [style.--delay]="(i % 6) * 0.1 + 's'"
                >
                  <div class="list-card__image">
                    <img [src]="recipe.imageUrl" [alt]="recipe.title" loading="lazy">
                  </div>
                  <div class="list-card__content">
                    <div class="list-card__header">
                      <h3 class="list-card__title">{{ recipe.title }}</h3>
                      <div class="list-card__tags">
                        @for (tag of recipe.tags.slice(0, 3); track tag) {
                          <span class="list-card__tag">{{ tag }}</span>
                        }
                      </div>
                    </div>
                    <p class="list-card__desc">{{ recipe.description }}</p>
                    <div class="list-card__footer">
                      <div class="list-card__meta">
                        <span class="list-card__time">
                          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="10"></circle>
                            <polyline points="12 6 12 12 16 14"></polyline>
                          </svg>
                          {{ recipe.cookingTime }} 分鐘
                        </span>
                        <span class="list-card__servings">
                          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                            <circle cx="9" cy="7" r="4"></circle>
                          </svg>
                          {{ recipe.servings }} 人份
                        </span>
                        <span class="list-card__rating">
                          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                            <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon>
                          </svg>
                          {{ recipe.rating }}
                        </span>
                      </div>
                      <span class="list-card__link">查看食譜 →</span>
                    </div>
                  </div>
                </a>
              }
            </div>
          }

          <!-- 載入更多 -->
          @if (hasMore()) {
            <div class="load-more">
              @if (isLoading()) {
                <div class="loading-spinner loading-spinner--small"></div>
                <span>載入中...</span>
              } @else {
                <button type="button" class="load-more__btn" (click)="loadMore()">
                  載入更多食譜
                </button>
              }
            </div>
          } @else if (displayedRecipes().length > 0) {
            <div class="end-message">
              <p>— 已顯示所有 {{ totalResults() }} 筆食譜 —</p>
            </div>
          }
        }
      </div>
    </section>
  } @else {
    <!-- 預設顯示（未搜尋時） -->

    <!-- Featured Categories -->
    <section class="featured-section">
      <div class="container">
        <h2 class="section-title">推薦食譜主題</h2>
        <div class="featured-grid">
          @for (category of featuredCategories(); track category.id) {
            <app-category-card
              [id]="category.id"
              [title]="category.title"
              [imageUrl]="category.imageUrl"
              [description]="category.description"
            />
          }
        </div>
      </div>
    </section>

    <!-- Top 10 Section -->
    <section class="top10-section">
      <div class="container">
        <h2 class="section-title">Top 10 熱門食譜</h2>
        <div class="top10-scroll">
          @for (recipe of topRecipes(); track recipe.id; let i = $index) {
            <a [routerLink]="['/recipes', recipe.id]" class="top10-card">
              <div class="top10-card__rank">{{ i + 1 }}</div>
              <img [src]="recipe.imageUrl" [alt]="recipe.title" class="top10-card__image">
              <div class="top10-card__info">
                <h3 class="top10-card__title">{{ recipe.title }}</h3>
                <div class="top10-card__meta">
                  <span class="top10-card__time">{{ recipe.cookingTime }} 分鐘</span>
                  <span class="top10-card__rating">★ {{ recipe.rating }}</span>
                </div>
              </div>
            </a>
          }
        </div>
      </div>
    </section>

    <!-- Main Content with Sidebar -->
    <section class="main-content">
      <div class="container">
        <div class="content-layout">
          <!-- Recipe Grid -->
          <div class="content-main">
            <div class="filter-bar">
              <h2 class="filter-bar__title">你想吃什麼？先幫你整理好了！</h2>
              <div class="filter-bar__filters">
                <select 
                  class="filter-select"
                  [value]="selectedTime()"
                  (change)="selectedTime.set($any($event.target).value)"
                >
                  @for (option of timeOptions; track option.value) {
                    <option [value]="option.value">{{ option.label }}</option>
                  }
                </select>
                <select 
                  class="filter-select"
                  [value]="selectedStyle()"
                  (change)="selectedStyle.set($any($event.target).value)"
                >
                  @for (option of styleOptions; track option.value) {
                    <option [value]="option.value">{{ option.label }}</option>
                  }
                </select>
              </div>
            </div>

            <div class="recipe-grid">
              @for (recipe of displayedDefaultRecipes(); track recipe.id) {
                <app-recipe-card
                  [id]="recipe.id"
                  [title]="recipe.title"
                  [imageUrl]="recipe.imageUrl"
                  [cookingTime]="recipe.cookingTime"
                  [rating]="recipe.rating"
                />
              }
            </div>

            <!-- 載入更多 -->
            @if (hasMoreDefault()) {
              <div class="load-more">
                @if (isLoadingDefault()) {
                  <div class="loading-spinner loading-spinner--small"></div>
                  <span>載入中...</span>
                } @else {
                  <button type="button" class="load-more__btn" (click)="loadMoreDefault()">
                    查看更多食譜（{{ displayedDefaultRecipes().length }} / {{ totalDefaultRecipes() }}）
                  </button>
                }
              </div>
            } @else if (displayedDefaultRecipes().length > 0) {
              <div class="end-message">
                <p>— 已顯示所有 {{ totalDefaultRecipes() }} 筆食譜 —</p>
              </div>
            }
          </div>

          <!-- Sidebar -->
          <aside class="content-sidebar">
            <app-sidebar 
              [title]="'人氣食譜排行榜'"
              [recipes]="sidebarRecipes()"
            />
          </aside>
        </div>
      </div>
    </section>
  }

  <!-- CTA Section -->
  <app-cta-section />
</div>
